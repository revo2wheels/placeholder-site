<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pipeline Architecture â€” Current vs Future | Coach GPT App</title>
  <link rel="icon" type="image/png" href="https://avatars.githubusercontent.com/u/44225520?v=4" />
  <style>
    body {
      font-family: 'Inter', Arial, sans-serif;
      margin: 0;
      background-color: #0f172a;
      color: #f8fafc;
      line-height: 1.6;
    }
    header {
      background-color: #020617;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 2rem;
      border-bottom: 1px solid #1e293b;
    }
    header h1 {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-size: 1.25rem;
      margin: 0;
    }
    header h1 img {
      width: 36px;
      height: 36px;
      border-radius: 50%;
    }
    header nav a {
      color: #cbd5e1;
      margin-left: 1.5rem;
      text-decoration: none;
      font-weight: 500;
    }
    header nav a:hover {
      color: #38bdf8;
    }
    header nav a[href*="pipeline"] {
      color: #38bdf8;
      font-weight: 600;
    }
    main {
      padding: 3rem 2rem;
      max-width: 1000px;
      margin: 0 auto;
    }
    h2 {
      color: #38bdf8;
      border-bottom: 1px solid #1e293b;
      padding-bottom: 0.25rem;
      margin-top: 2.5rem;
    }
    .diagram {
      background-color: #1e293b;
      border-radius: 0.75rem;
      padding: 1rem;
      overflow-x: auto;
      font-family: 'Courier New', monospace;
      font-size: 0.9rem;
      color: #e2e8f0;
      box-shadow: 0 1px 2px rgba(0,0,0,0.3);
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 1rem;
    }
    th, td {
      border: 1px solid #1e293b;
      padding: 0.5rem 0.75rem;
      text-align: left;
    }
    th {
      background: #0f172a;
      color: #38bdf8;
    }
    footer {
      text-align: center;
      padding: 2rem;
      font-size: 0.85rem;
      color: #94a3b8;
      border-top: 1px solid #1e293b;
      background-color: #020617;
    }
    footer a {
      color: #38bdf8;
      text-decoration: none;
    }
    footer a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <header>
    <h1>
      <img src="https://avatars.githubusercontent.com/u/44225520?v=4" alt="App Icon" />
      <a href="https://www.cliveking.net" style="color:#fff;text-decoration:none;">Coach GPT App</a>
    </h1>
    <nav>
      <a href="https://www.cliveking.net#about">About</a>
      <a href="https://www.cliveking.net#features">Features</a>
      <a href="https://www.cliveking.net#profile">Coach Profile</a>
      <a href="https://www.cliveking.net#intervals">Intervals.icu</a>
      <a href="https://www.cliveking.net#samples">Samples</a>
      <a href="https://www.cliveking.net/pipeline.html" style="color:#38bdf8;font-weight:600;">DESIGN</a>
    </nav>
  </header>

  <main>
    <h1 style="text-align:center;color:#38bdf8;">System Architecture â€” Current</h1>

    <p style="text-align:center;max-width:700px;margin:0 auto 2rem;">
      This document describes the current operational pipeline for the <strong>Coach GPT App</strong>, identifies key architectural issues,
      and outlines the next-generation <strong>Render Container Architecture</strong> for stable, scalable computation.
    </p>

    <h2>Current Architecture</h2>
    <div class="diagram">
<pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ChatGPT App       â”‚
â”‚  (UI + tool invocation)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ HTTPS tool call
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Cloudflare Worker      â”‚
â”‚  â€¢ Auth proxy only       â”‚
â”‚  â€¢ No computation        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Railway FastAPI Backend          â”‚
â”‚  â€¢ Tier-0 fetch (activities/wellness)
â”‚  â€¢ Tier-1 normalization + snapshots
â”‚  â€¢ Tier-2 enforced totals + audits  â”‚
â”‚  â€¢ Semantic JSON (URF v5.1)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Intervals.icu API    â”‚
â”‚  (Authoritative source)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
    </div>

<h2>Current Architecture Guarantees</h2>
<table>
  <tr><th>Area</th><th>Implementation</th><th>Result</th></tr>

  <tr>
    <td>Execution Model</td>
    <td>Real Python execution on Railway (FastAPI)</td>
    <td>Deterministic, reproducible results</td>
  </tr>

  <tr>
    <td>Cloudflare Role</td>
    <td>Auth + request proxy only (no computation)</td>
    <td>No payload mutation or logic drift</td>
  </tr>

  <tr>
    <td>Data Fetch</td>
    <td>Tier-0 authenticated ICU fetch with fixed windows</td>
    <td>Stable datasets and predictable scope</td>
  </tr>

  <tr>
    <td>Audit Pipeline</td>
    <td>Tier-0 â†’ Tier-1 â†’ Tier-2 enforced validation</td>
    <td>Totals locked; variance explicitly checked</td>
  </tr>

  <tr>
    <td>Totals Authority</td>
    <td>Tier-2 hard-enforced event-only totals</td>
    <td>No weekly bleed into season or summary reports</td>
  </tr>

  <tr>
    <td>Serialization</td>
    <td>Single-pass JSON (no base64, no double encoding)</td>
    <td>No numeric precision loss</td>
  </tr>

  <tr>
    <td>State Handling</td>
    <td>Context preserved across Tier boundaries</td>
    <td>No redundant ICU fetches</td>
  </tr>

  <tr>
    <td>Schema Control</td>
    <td>Unified Reporting Framework (URF v5.1)</td>
    <td>Explicit contracts between pipeline stages</td>
  </tr>

  <tr>
    <td>Observability</td>
    <td>Structured logs at each Tier boundary</td>
    <td>Full traceability of audit decisions</td>
  </tr>
</table>

<h2>Design Principles</h2>
<table>
  <tr><th>Principle</th><th>Meaning in Practice</th></tr>

  <tr>
    <td>Determinism</td>
    <td>All metrics are computed once, audited, and reused without recomputation</td>
  </tr>

  <tr>
    <td>Separation of Concerns</td>
    <td>Edge handles auth and routing; backend handles computation and audits</td>
  </tr>

  <tr>
    <td>Auditability</td>
    <td>Every report can be traced back to Tier-0 source data</td>
  </tr>

  <tr>
    <td>Schema Stability</td>
    <td>URF contracts prevent silent field drift between versions</td>
  </tr>

  <tr>
    <td>Numerical Integrity</td>
    <td>No virtual math, no inference, no approximations</td>
  </tr>
</table>

    <h2>ğŸ§  Pipeline</h4>
    <ul>
      <li>Extend reports to cover full season year, last 365 days or when your season started</li>
      <li>Convert actions to calendar events in Intervals, e.g. plan for next week</li>
      <li>Convert Calendar event workouts to downloadable files e.g. ZWO, and for upload to Intervals library directly via chat instruction</li>      
  </main>

  <footer>
    <p>&copy; 2025 <a href="https://www.cliveking.net">Clive King</a> Â· Coach GPT App â€” Unified Pipeline Architecture</p>
  </footer>
</body>
</html>
