<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pipeline Architecture â€” Unified Prefetch Design | Coach GPT App</title>
  <link rel="icon" type="image/png" href="https://avatars.githubusercontent.com/u/44225520?v=4" />
  <link rel="stylesheet" href="assets/css/style.css?v=1.8">
</head>

<body>
  <!-- ===================================================
  ğŸ§­ HEADER
  ==================================================== -->
  <header>
    <h1>
      <img src="https://avatars.githubusercontent.com/u/44225520?v=4" alt="App Icon" />
      <a href="https://www.cliveking.net">Coach GPT App</a>
    </h1>
    <nav>
      <a href="https://www.cliveking.net#about">About</a>
      <a href="https://www.cliveking.net#features">Features</a>
      <a href="https://www.cliveking.net#Reports">Reports</a>
      <a href="https://www.cliveking.net#Questions">Questions</a>
      <a href="https://www.cliveking.net#samples">Samples</a>
      <a href="https://www.cliveking.net#coach">Coach</a>
      <a href="https://www.cliveking.net#download">Download</a>
      <a href="https://www.cliveking.net#contact">Contact</a>
      <a href="https://www.cliveking.net/changelog.html">CHANGELOG</a>
      <a href="https://www.cliveking.net/pipeline.html" style="font-weight:bold;color:#38bdf8;">DESIGN</a>
    </nav>
  </header>

  <main>


    <!-- ===================================================
    âš™ï¸ CURRENT PIPELINE
    ==================================================== -->
    <section class="card">
      <h1>Unified Prefetch Architecture â€” v5.1 Design</h1>
      <p style="text-align:center;max-width:750px;margin:0 auto 2rem;">
        The <strong>Coach GPT App</strong> now runs on a unified prefetch architecture that separates
        <em>data retrieval</em>, <em>normalization</em>, and <em>semantic report generation</em>
        across Cloudflare and Railway.
        This ensures deterministic output, fixed schema contracts, and verifiable data lineage from
        <strong>Intervals.icu</strong>.
      </p>
    </section>

    <section class="card" style="border-left:4px solid #22c55e;">
      <h2>ğŸŸ¢ What Exists Today vs ğŸ”µ What Comes Next</h2>
      <p>
        The Coach GPT App is already fully operational today using a deterministic,
        audited pipeline. The sections below distinguish between:
      </p>
      <ul>
        <li><strong>ğŸŸ¢ Current Architecture</strong> â€” running in production now</li>
        <li><strong>ğŸ”µ Future Architecture</strong> â€” planned evolution toward MCP-native, multi-LLM operation</li>
      </ul>
    </section>

    <section class="card" style="border-left:4px solid #22c55e;">
      <h2>âš™ï¸ Current Operational Pipeline (Production)</h2>
      <p class="muted">
        Status: <strong>Live</strong> â€¢ Used in production â€¢ Backward compatible
      </p>

      <div class="codeblock"
        style="font-family:'Courier New',monospace;font-size:0.9rem;overflow-x:auto;text-align:center;">
        <pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ChatGPT / CLI App     â”‚
â”‚  (Tool invocation layer)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚  HTTPS tool call
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Cloudflare Worker (Edge)            â”‚
â”‚  â€¢ Auth + routing proxy                      â”‚
â”‚  â€¢ Handles start/end normalization           â”‚
â”‚  â€¢ Prefetches Intervals data â†’ JSON context  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Railway Backend (FastAPI)            â”‚
â”‚  â€¢ Tier-0: Prefetch normalization            â”‚
â”‚     - DataFrame coercion + baseline columns  â”‚
â”‚     - Empty-source detection + AuditHalt     â”‚
â”‚  â€¢ Tier-1: Activity & wellness validation    â”‚
â”‚     - moving_time filtering, zero-checks     â”‚
â”‚  â€¢ Tier-2: Aggregation + enforcement         â”‚
â”‚     - Totals reconciliation, variance checks â”‚
â”‚  â€¢ Outputs URF v5.1 Semantic JSON            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Intervals.icu API        â”‚
â”‚   (authoritative source)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
      </div>
      <p style="text-align:center;margin-top:1rem;">
        ğŸ”„ Cloudflare handles authentication, routing, and optional synthetic testing.<br>
        ğŸš‰ Railway performs full computation, validation, and serialization.
      </p>
    </section>

    <!-- ===================================================
    ğŸ§© PIPELINE GUARANTEES
    ==================================================== -->
    <section class="card">
      <h2>ğŸ§© Architecture Guarantees</h2>
      <table>
        <thead>
          <tr>
            <th>Area</th>
            <th>Implementation</th>
            <th>Guarantee</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Prefetch Flow</td>
            <td>Cloudflare normalizes date params and injects optional test payloads</td>
            <td>Safe staging tests without real data</td>
          </tr>
          <tr>
            <td>Execution Model</td>
            <td>Python execution on Railway (FastAPI + Pandas)</td>
            <td>Deterministic, audited output</td>
          </tr>
          <tr>
            <td>Tier-0 Validation</td>
            <td>Baseline column checks (`moving_time`, `distance`, etc.)</td>
            <td>No schema drift or missing fields</td>
          </tr>
          <tr>
            <td>Tier-1 Audit</td>
            <td>Filters invalid / null activities, computes daily summaries</td>
            <td>Enforced numeric consistency</td>
          </tr>
          <tr>
            <td>Tier-2 Enforcement</td>
            <td>Lock totals, enforce logical consistency</td>
            <td>No variance bleed between scopes</td>
          </tr>
          <tr>
            <td>Serialization</td>
            <td>Single-pass semantic JSON (no float loss)</td>
            <td>Stable numeric precision</td>
          </tr>
          <tr>
            <td>Observability</td>
            <td>Structured logs at all Tier boundaries</td>
            <td>Traceable audit chain (lightâ†’fullâ†’wellness)</td>
          </tr>
          <tr>
            <td>Schema Version</td>
            <td>URF v5.1 unified contracts</td>
            <td>Cross-version compatibility with GPT tool API</td>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- ===================================================
ğŸ§  LLM-NATIVE ARCHITECTURE
==================================================== -->
    <section class="card" style="border-left:4px solid #38bdf8;">
      <h2>ğŸ§  Future LLM-Native Architecture (Planned)</h2>

      <table>
        <thead>
          <tr>
            <th>Design Goal</th>
            <th>Implementation</th>
            <th>Guarantee</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Natural Language Interface</td>
            <td>LLMs interact exclusively via MCP tools (no UI state, no clicks)</td>
            <td>Human-like interaction without loss of determinism</td>
          </tr>
          <tr>
            <td>Multi-LLM Compatibility</td>
            <td>MCP-standard tool schemas (OpenAI, Anthropic, Mistral, local models)</td>
            <td>No vendor lock-in; identical outputs across models</td>
          </tr>
          <tr>
            <td>Secure Access Control</td>
            <td>Cloudflare Workers act as MCP + OAuth gateway</td>
            <td>Intervals.icu tokens never exposed to LLMs</td>
          </tr>
          <tr>
            <td>Edge Policy Enforcement</td>
            <td>OAuth scopes, rate limits, and request validation at Cloudflare Edge</td>
            <td>Strong isolation between clients, tools, and athletes</td>
          </tr>
          <tr>
            <td>Execution Engine</td>
            <td>Python services on Railway (FastAPI + Pandas)</td>
            <td>Deterministic, auditable metric computation</td>
          </tr>
          <tr>
            <td>Authoritative Data Source</td>
            <td>Intervals.icu APIs (activities, intervals, FIT-derived data)</td>
            <td>Single source of truth for all training data</td>
          </tr>
          <tr>
            <td>Semantic Contract</td>
            <td>URF v5.1 structured semantic JSON</td>
            <td>LLMs interpret results without recomputation or inference</td>
          </tr>
          <tr>
            <td>Context Integrity</td>
            <td>Explicit context windows (activity, 7d, 90d, rolling)</td>
            <td>No accidental â€œseasonalâ€ or cross-scope mislabeling</td>
          </tr>
          <tr>
            <td>Headless by Design</td>
            <td>No dependency on web UI or dashboards</td>
            <td>Future-proof for voice, agents, automation, and APIs</td>
          </tr>
          <tr>
            <td>Tool-First Expansion</td>
            <td>New capabilities exposed as MCP tools</td>
            <td>Feature growth without breaking existing clients</td>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- ===================================================
ğŸ§© FUTURE PIPELINE
==================================================== -->

    <section class="card" style="border-left:4px solid #38bdf8;">
      <h2>âš™ï¸ Future Operational Pipeline</h2>
      <p class="muted">
        Status: <strong>Planned</strong> â€¢ Incremental rollout â€¢ No breaking changes
      </p>

      <div class="codeblock"
        style="font-family:'Courier New',monospace;font-size:0.9rem;overflow-x:auto;text-align:center;">
        <pre>

ğŸ§­ System Diagram

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Human / LLM Agent â”‚
â”‚  (Chat, Voice, AI) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚  Natural Language
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MCP Tool Interface (Standard)â”‚
â”‚ â€¢ Typed tool contracts       â”‚
â”‚ â€¢ No UI state                â”‚
â”‚ â€¢ Multi-LLM compatible       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ MCP call
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cloudflare Edge (OAuth + MCP)â”‚
â”‚ â€¢ OAuth token handling       â”‚
â”‚ â€¢ Scope enforcement          â”‚
â”‚ â€¢ Rate limiting              â”‚
â”‚ â€¢ Request normalization      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ Authenticated request
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Railway Execution Layer      â”‚
â”‚ (FastAPI + Pandas)           â”‚
â”‚ â€¢ Tier-0 validation          â”‚
â”‚ â€¢ Tier-1 audit               â”‚
â”‚ â€¢ Tier-2 enforcement         â”‚
â”‚ â€¢ Deterministic computation  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ Canonical queries
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Intervals.icu APIs           â”‚
â”‚ â€¢ Activities (7d / 90d)      â”‚
â”‚ â€¢ Intervals & FIT-derived    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ Structured data
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Semantic JSON (URF v5.1)     â”‚
â”‚ â€¢ Explicit context windows   â”‚
â”‚ â€¢ Locked totals              â”‚
â”‚ â€¢ No recomputation allowed   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ Read-only
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LLM Rendering / Reasoning    â”‚
â”‚ â€¢ Descriptive only           â”‚
â”‚ â€¢ Coach-like narrative       â”‚
â”‚ â€¢ No metric invention        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

</pre>
      </div>
      <p style="text-align:Left;margin-top:1rem;">
        ğŸ”„ Cloudflare handles authentication, routing, and optional synthetic testing.<br>
        ğŸš‰ Railway performs full computation, validation, and serialization.<br>
        ğŸ’¡Independence from LLMs via MCP
      </p>
    </section>

    <section class="card" style="border-left:4px solid #38bdf8;">

      <h2>ğŸ”‘ Key Insights</h2>

      <ul>
        <li>
          <strong>There is no UI state</strong><br>
          Every interaction is stateless, reproducible, and tool-driven.
        </li>

        <li>
          <strong>LLMs never compute metrics</strong><br>
          They only interpret pre-computed, audited semantic JSON.
        </li>

        <li>
          <strong>OAuth tokens never reach the model</strong><br>
          Cloudflare fully isolates authentication from reasoning.
        </li>

        <li>
          <strong>Intervals.icu remains the single source of truth</strong><br>
          All metrics originate from published APIs or FIT-derived data.
        </li>

        <li>
          <strong>Context is explicit, never inferred</strong><br>
          Each metric declares whether it is activity, 7d, 90d, or rolling.
        </li>

        <li>
          <strong>The system is headless by design</strong><br>
          It works equally well for chat, voice, automation, or background agents.
        </li>
      </ul>

      <hr>

      <h2>âš™ï¸ How It Works (End-to-End)</h2>

      <ol>
        <li>
          <strong>User or AI issues a natural-language request</strong><br>
          Example: <em>â€œExplain my weekly intensity balance and recovery status.â€</em>
        </li>

        <li>
          <strong>Request is converted into an MCP tool call</strong>
          <ul>
            <li>Strongly typed inputs</li>
            <li>Explicit report scope (weekly / season / activity)</li>
          </ul>
        </li>

        <li>
          <strong>Cloudflare Edge handles trust and policy</strong>
          <ul>
            <li>OAuth token exchange with Intervals.icu</li>
            <li>Scope validation</li>
            <li>Rate limiting</li>
            <li>Parameter normalization</li>
          </ul>
        </li>

        <li>
          <strong>Railway executes the computation</strong>
          <ul>
            <li>Tier-0: schema + column validation</li>
            <li>Tier-1: numeric consistency and filtering</li>
            <li>Tier-2: locked totals and scope enforcement</li>
            <li>No cross-window leakage (e.g. weekly â‰  seasonal)</li>
          </ul>
        </li>

        <li>
          <strong>Canonical semantic JSON is produced</strong>
          <ul>
            <li>URF v5.1 contract</li>
            <li>Explicit context windows</li>
            <li>Deterministic numeric precision</li>
            <li>No derived ambiguity</li>
          </ul>
        </li>

        <li>
          <strong>LLM renders the report</strong>
          <ul>
            <li>Descriptive, coach-like language</li>
            <li>Anchored strictly to provided semantics</li>
            <li>No recomputation, guessing, or extrapolation</li>
          </ul>
        </li>
      </ol>

      <hr>

      <h2>ğŸ§  Why This Matters</h2>

      <p>
        This architecture enables natural language coaching at scale <strong>without</strong>:
      </p>

      <ul>
        <li>Dashboards</li>
        <li>Sliders</li>
        <li>Charts</li>
        <li>Hidden state</li>
        <li>Silent recomputation</li>
      </ul>

      <p>
        The result is a system that is:
      </p>

      <ul>
        <li>Auditable</li>
        <li>Secure</li>
        <li>Model-agnostic</li>
        <li>Future-proof</li>
        <li>Genuinely conversational</li>
      </ul>

      <p>
        <strong>Natural language becomes the interface â€” not the source of truth.</strong>
      </p>

    </section>



    <!-- ===================================================
ğŸ“¬ CONTACT SECTION
=================================================== -->
    <section id="contact">
      <div class="card">
        <h2>ğŸ“¬ Contact</h2>
        <p>
          For integration, customization, or coaching inquiries, connect via
          GitHub link below or DM via
          <a href="https://intervals.icu/athlete/1914741" target="_blank">Intervals.icu DM</a> and contribute in
          <a href="https://forum.intervals.icu/t/yet-another-ai-chatgpt-coach/117856" target="_blank">Intervals.icu
            Forum</a>.
        </p>

        <a href="https://github.com/revo2wheels/intervalsicugptcoach-public" target="_blank" class="github-button">
          <svg viewBox="0 0 16 16" aria-hidden="true">
            <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8a8 8 0 005.47 7.59c.4.07.55-.17.55-.38
                 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94
                 -.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21
                 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95
                 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21
                 2.2.82a7.6 7.6 0 012-.27c.68 0 1.36.09 2 .27 1.53-1.04
                 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82
                 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54
                 1.48 0 1.07-.01 1.93-.01 2.19 0 .21.15.46.55.38A8.01 8.01 0
                 0016 8c0-4.42-3.58-8-8-8z" />
          </svg>
          <strong>github.com/revo2wheels</strong>
        </a>
        <p class="muted" style="margin-top:1rem; text-align:Left;">
          Built with â¤ï¸ for endurance athletes â€” by <strong>Clive King</strong>.<br>
          Powered by <a href="https://intervals.icu" target="_blank">Intervals.icu</a>, Cloudflare and the <a
            href="https://railway.com?referralCode=-xO_3x">Railway</a> Engine.
        </p>
      </div>
    </section>
    <!-- ===================================================
ğŸ¦¶ FOOTER
=================================================== -->
    <footer id="footer">
      <p>
        Â© 2025 Coach GPT App â€” Data-driven endurance intelligence.<br>
        Powered by <a href="https://intervals.icu" target="_blank">Intervals.icu</a>
        and the <a href="https://railway.com?referralCode=-xO_3x">Railway</a> Engine.
      </p>
    </footer>
</body>

</html>